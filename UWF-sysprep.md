---
title: UWF 機能を有効化した環境で Sysprep を用いたマスター イメージを作成する場合の留意点について
date: 2020-07-27 17:00:00
categories:
- Unified Write Filter
tags:
- Sysprep
---
UWF 機能を有効化した環境で Sysprep を用いたマスター イメージを作成する場合の留意点をご紹介いたします。
<!-- more -->
<br>

***
統合書き込みフィルター (UWF) は、Windows 10 のオプション機能になります。端末のキッティングにあたり UWF 機能を有効化した状態でマスター イメージを作成する場合、まずは以下のサイトの情報に従い UWF 機能をインストールします。  

- [統合書き込みフィルター (UWF) 機能の使用](https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/iot-ent-device-lockdown-features#unified-write-filter-uwf)
   > (抜粋)  
   1\. 次の機能をインストールします。  
   a. [スタート] をクリックし、「 Windows の機能の有効化または無効化」と入力します。  
   b. [Windows の機能] ウィンドウで、 [デバイスロックダウン] ノードを展開し、[統合書き込みフィルター > OK] をオンにします。  
   : ※ 一部省略   
   d. [閉じる] をクリックして、 [Windows の機能] ウィンドウを閉じます。

インストールが完了した状態は、UWF フィルターは無効化されています。この状態で sysprep を実行し、マスター イメージを作成ください。  
既に UWF のフィルターを有効化していた場合、後述の留意事項をご確認ください。

### 留意事項について
UWF フィルターを有効化した状態や、ボリューム保護の設定をした後でマスター イメージを作成した場合、UWF の設定が正常に引き継がれません。以下の留意点をご確認いただき、それぞれ対処を実施ください。

- UWF フィルターを有効化した環境の場合、sysprep を実行してもイメージの一般化は行われません。UWF フィルターを有効化した環境の場合、以下のコマンドを実行後、OS を再起動して UWF フィルターを無効化ください。  
   ```
   uwfmgr filter disable 
   ```

- ドライブの書き込み保護の設定は、イメージの展開後の環境では有効に動作いたしません。これは、UWF が保持している保護対象ボリュームの GUID が、イメージ展開後の環境で変わってしまうためです。もし C ドライブの保護設定を行っていた場合、以下のコマンドを実行後に OS を再起動し、保護を解除ください。
   ```
   uwfmgr volume unprotect C:
   ```

- UWF の除外パスやオーバーレイの設定につきましては、イメージ展開後に問題が発生したという報告はございません。しかしながら、設定するパスや展開後の環境に依存して問題が発生する可能性がございますので、基本的にイメージ展開後に実行することを推奨いたします。  
</br>

***
`変更履歴`  
`2020/07/27 created by Mochizuki`  